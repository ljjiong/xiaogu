<!-- 新建html模板页 -->

<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport"
    content="initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=no, width=device-width">
  <meta name="keywords" content="wancllshop">
  <title></title>
  <!-- 公共资源文件引入 -->
  <link rel="stylesheet" href="__static__/common/css/loading.css" type="text/css">

  <link rel="stylesheet" href="__static__/wap/aui/css/aui.css" type="text/css">
  <link rel="stylesheet" href="__static__/wap/css/wap.css" type="text/css">
  <link rel="stylesheet" type="text/css" href="__static__/wap/aui/css/aui-flex.css" />

  <!-- 图标库 -->
  <link rel="stylesheet" type="text/css" href="__static__/common/css/ali_icon/iconfont.css" />

  <script src="__static__/common/script/wapRouter.js" type="text/javascript"></script>
  <script src="__static__/vue/vue-2.5.15/vue.min.js" type="text/javascript"></script>
  <script src="__static__/axios/axios.min.js"></script>
  <script src="__static__/jquery-3.2.1.min.js" type="text/javascript"></script>
  <script src="__static__/layer-v3.1.1/layer/layer.js" type="text/javascript"></script>


  <script src="__static__/common/script/httpPromise.js"></script>
  <script src="__static__/common/script/common.js" type="text/javascript"></script>
  <script src="__static__/common/script/config.js" type="text/javascript"></script>

  <link rel="icon" id="icon-img" href="" type="image/x-icon" />


  <!-- <script>
    document.title = getStorage('systemParams').system_title || ''
    document.getElementById("icon-img").href = getStorage('systemParams').web_icon;
  </script> -->
  <style type="text/css">
    body {
      background-color: #fff;
    }

    .detail-top-cont {
      align-items: center;
      background-color: #fff;
      display: flex;
    }

    .detail-top-cont .item-chose {
      flex: 1;
      text-align: center;
      height: 2.6rem;
      color: #999999;
      line-height: 2.6rem;
      box-sizing: border-box;
    }

    .detail-top-cont .item-chose.on-active {
      color: #333333;
      border-bottom: 1px solid #e75151;
    }

    .detail-content .detail-block {
      background-color: #f7f7f7;
    }

    .detail-content .block-title {
      padding-left: 0.9rem;
      position: relative;
      background: url(__static__/wap/img/left-icon.png) no-repeat;
      background-position: left center;
      background-size: auto 100%;
      line-height: 1.4;
    }

    .detail-content .block-cont {
      padding-left: 0.9rem;
    }

    .detail-content .detail-item {
      padding-left: 1.5rem;
      position: relative;
      line-height: 22px
    }

    .detail-content .detail-block.on-active {
      border-left: 14px solid #e75151;
    }

    .detail-content .detail-block {
      background-color: #f7f7f7;
      border-radius: 6px;
      padding-top: 1.2rem;
      padding-bottom: 1.2rem;
      overflow: hidden;
    }

    .detail-content .detail-item img {
      position: absolute;
      left: 0;
      top: 3px;
      width: 16px;
      height: 16px;
    }

    .detail-content .right-cont {
      margin-left: auto;
      height: 32px;
      line-height: 32px;
      width: 66px;
      border-radius: 5px;
      text-align: center;
    }

    .detail-content .complete-block {
      background-color: #fff;
      color: #999999;
    }

    .detail-content .unfinished-block {
      background-color: #e75151;
      color: #fff;
    }

    .detail-content .detail-item {
      position: relative;
      line-height: 22px
    }

    .detail-content .detail-text {
      display: flex;
      align-items: center;
      justify-content: space-between;
      color: #999999;
    }

    .file-top-cont {
      display: flex;
      align-items: center;
      justify-content: space-between
    }

    .file-top-cont .right-cont {
      color: #fff;
      background-color: #e75151;
      height: 30px;
      line-height: 30px;
      border-radius: 30px;
      padding: 0 12px;
    }

    .detail-margin {
      margin: 10px;
      padding-bottom: 0;
    }

    .detail-content .complete-block {
      background-color: rgb(231, 81, 81);
    }

    .detail-content .complete-block a {
      color: #fff;
    }

    .aa {
      width: 100%;
      height: 300px;
      overflow-y: scroll;
      float: left;
    }

    .unpass {
      border: 0;
      width: 90%;
      height: 40px;
      background: rgba(255, 255, 255, 1);
      box-shadow: 0px 0px 11px 0px rgba(51, 51, 51, 0.1);
      font-size: 14px;
      font-family: PingFang-SC-Regular;
      color: rgba(230, 0, 18, 1);
    }

    .pass {
      border: 0;
      width: 90%;
      height: 40px;
      background: linear-gradient(-56deg, rgba(230, 0, 18, 1) 0%, rgba(230, 0, 18, 0.7) 100%);
      box-shadow: 0px 0px 11px 0px rgba(51, 51, 51, 0.1);
      font-size: 14px;
      font-family: PingFang-SC-Regular;
      color: rgba(255, 255, 255, 1);
      line-height: 22px;
    }

    .affirm {
      border: 0;
      width: 90%;
      height: 40px;
      background: linear-gradient(-56deg, rgba(185, 183, 184, 0.7) 0%, rgb(141, 140, 140) 100%);
      box-shadow: 0px 0px 11px 0px rgba(51, 51, 51, 0.1);
      font-size: 14px;
      font-family: PingFang-SC-Regular;
      color: rgba(255, 255, 255, 1);
      line-height: 22px;
    }

    #footer {
      display: flex;
      align-items: center;
    }
  </style>
</head>

<body>
  <div id="app">
    <!-- 头部 -->
    <header class="aui-bar aui-bar-nav aui-bar-light" id="header" style="background:#e75151;">
      <div class="Leave_blank" style="margin-top: 1rem;">
        <a class="aui-pull-left aui-btn" onclick="gotowap('index')">
          <span style="color: #fff!important;" class="aui-iconfont aui-icon-left"></span>
        </a>
        <div class="aui-title" v-text="title" style="color: #fff"></div>
      </div>
    </header>
    </header>
    <!-- 中间页 -->
    <div class="aui-content" style="margin-bottom: 14%;">
      <div class="detail-top-cont aui-padded-l-10 aui-padded-r-10">
        <div class="item-chose aui-font-size-16 on-active" id="details" @click="showindex">详情</div>
        <!-- <div class="item-chose aui-font-size-16" id="task" @click="changStatic">任务</div> -->
      </div>
      <div class="detail-content">
        <!-- 任务详情 -->
        <div id="Project_details">
          <div class="detail-block aui-margin-b-10 aui-padded-r-15 aui-padded-l-15">
            <div class="block-title aui-font-size-16 aui-margin-b-5">任务名称</div>
            <div class="block-cont aui-font-size-14">
              {{mission.project_name}}
            </div>
          </div>
          <div class="detail-block aui-margin-b-10 aui-padded-r-15 aui-padded-l-15">
            <div class="block-title aui-font-size-16 aui-margin-b-5">任务说明</div>
            <div class="block-cont aui-font-size-14">
              <!-- 武冈水利移动APP开发武冈水利移动APP开发武冈水利移动APP开发武冈水利移动APP开发武冈水利移动APP开发武冈水利移动APP开发。 -->
              {{mission.task==null?'暂无':mission.task}}
            </div>
          </div>
          <div class="detail-block aui-margin-b-10 aui-padded-r-15 aui-padded-l-15">
            <div class="block-title aui-font-size-16 aui-margin-b-5">任务负责人</div>
            <!--任务负责人-->
            <div class="block-cont aui-font-size-14">
              {{mission.project_managers.nick_name}}
            </div>
          </div>
          <div class="detail-block aui-margin-b-10 aui-padded-r-15 aui-padded-l-15">
            <div class="block-title aui-font-size-16 aui-margin-b-5">任务参与人</div>
            <div class="aa">
              <div class="aui-label" v-for="cyrs in mission.project_members" style="margin: 5px;">
                <span>{{cyrs}}</span>
              </div>
            </div>
          </div>
          <div class="detail-block aui-margin-b-10 aui-padded-r-15 aui-padded-l-15">
            <div class="block-title aui-font-size-16 aui-margin-b-5">任务起止时间</div>
            <div class="block-cont aui-font-size-14">
              {{mission.create_time}}&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp; {{mission.end_time}}
            </div>
          </div>
        </div>
        <!-- 任务列表 -->
        <!-- <div id="Project_Detailfile" style="display: none;">
          <div class="detail-block aui-padded-r-15 aui-padded-l-15 on-active aui-margin-b-10"
            style="padding-bottom: 0;margin: 10px;" v-for="tasks in mytasks">
            <div class="detail-block aui-padded-r-15 aui-padded-l-15 aui-margin-b-10">
              <div class="aui-margin-b-15 detail-item aui-font-size-14"><img
                  src="__static__/wap/img/fw-icon1.png">时间：{{tasks.create_time}}&nbsp;-&nbsp;{{tasks.end_time}}</div>
              <div class="aui-margin-b-15 detail-item aui-font-size-14" v-show="tasks.projects != ''"><img
                  src="__static__/wap/img/fw-icon2.png">指派人：{{tasks.projects.department}}
              </div>
              <div class="aui-margin-b-15 detail-item aui-font-size-14"><img
                  src="__static__/wap/img/fw-icon3.png">执行人：{{tasks.performers.nick_name}}
              </div>
              <div class="detail-item aui-font-size-14" v-show="tasks.projects != ''"><img
                  src="__static__/wap/img/fw-icon4.png">内容：{{tasks.projects.project_name}}。</div>
              <div class="complete-block right-cont aui-margin-t-15 aui-font-size-16">已完成</div>
            </div>
          </div>
        </div> -->
        <!-- 详情文件 -->
        <!-- <div id="Project_task" style="display: none;">
          <div class="file-top-cont aui-padded-l-10 aui-padded-r-10 aui-padded-t-15 aui-padded-b-15">
            <div class="left-cont aui-font-size-16">全部文件</div>
          </div>
          <div class="detail-content aui-padded-15 aui-padded-t-0">
            <div class="detail-block aui-padded-15 aui-margin-b-10">
              <div class="aui-margin-b-5 detail-item aui-font-size-14">{{mission.project_name}}</div>
              <div class="detail-item aui-margin-b-10 aui-font-size-14">
                <div class="complete-block right-cont aui-margin-t-15 aui-font-size-16"><a
                    :href="mission.project_documentation">导出</a></div>
              </div>
              <div class="detail-text aui-padded-b-5">
                <div class="left-text aui-font-size-14">{{mission.update_time}}</div>
                <div class="right-text aui-font-size-14">{{mission.nick_name}}</div>
              </div>
            </div>
          </div>
        </div> -->
      </div>
    </div>
    <footer class="aui-bar aui-bar-tab" id="footer" v-if="mission.project_manager == user.id && mission.states == 0">
      <div class="aui-col-xs-12">
        <button class="pass" @click="msgpass(mission.id)">完成</button>
      </div>
    </footer>
    <footer class="aui-bar aui-bar-tab" id="footer"
      v-if="mission.uid == user.id && mission.states == 1 && mission.affirm == 0">
      <div class="aui-col-xs-12">
        <button class="pass" @click="acceptance(mission.id,mission.uid)">验收</button>
      </div>
    </footer>
    <footer class="aui-bar aui-bar-tab" id="footer"
      v-if="mission.uid == user.id && mission.states == 1 && mission.affirm == 1">
      <div class="aui-col-xs-12">
        <button class="affirm">已验收</button>
      </div>
    </footer>
  </div>
  <script>
    var app = new Vue({
      el: '#app',
      data: {
        user: user,
        title: '任务资料',
        mission: {},
        mytasks: '',
        activeFooterIndex: 1,
        myfile: '',
        href: '',

      },
      methods: {
        // 点击详情菜单事件
        showindex() {
          $("#Project_details").show();
          $("#Project_task").hide();
          $("#Project_Detailfile").hide();
          $("#details").addClass("on-active");
          $("#task,#Detail_file").removeClass("on-active");
        },
        // 点击任务事件
        // changStatic: function () {
        //   var that = this;
        //   console.log(that)
        //   if (that.mytasks == '') {
        //     httpRequest('POST', 'api_project/project/list_rw', {
        //       id: getQueryString('id'),
        //     }, ).then(function (resp) {
        //       resp.data.avatar = resp.data.avatar || '__static__/wap/img/touxi.png';
        //       setStorage(getClientType() + 'mytasks', resp.data);
        //       that.mytasks = resp.data;
        //     });
        //   }
        //   console.log("我的任务");
        //   $("#Project_details").hide();
        //   $("#Project_task").hide();
        //   $("#Project_Detailfile").show();
        //   $("#task").addClass("on-active");
        //   $("#details,#Detail_file").removeClass("on-active");
        // },
        // 点击详情文件
        changStatic1: function () {
          var that = this;
          $("#Project_details").hide();
          $("#Project_task").show();
          $("#Project_Detailfile").hide();
          $("#Detail_file").addClass("on-active");
          $("#details,#task").removeClass("on-active");
        },
        acceptance(id, uid) {
          layer.confirm('确认验收任务?', {
            title: '提示',
          }, function (index) {
            httpRequest('POST', 'api_project/project_detail/affirm', {
              id: id,
              uid: uid,
              // project_manager: user.id,
              affirm: 1,
              // affirm: 1
            }).then(function (resp) {
              layer.msg("任务已验收！", function () {
                gotowap('index')
              });
            })
          })
        },
        msgpass(id) {
          layer.confirm('确认完成任务?', {
            title: '提示',
          }, function (index) {
            httpRequest('POST', 'api_project/project_detail/update', {
              id: id,
              // project_manager: user.id,
              states: 1,
              // affirm: 1
            }).then(function (resp) {
              layer.msg("任务已完成！", function () {
                gotowap('index')
              });
            })
          })
        },
      },
      computed: {

      },
      filters: {

      },
      mounted: function () {
        var that = this;
        //this.getParams()
        httpRequest('POST', 'api_project/project_detail/read', {
          id: getQueryString('id'),
        }, ).then(function (resp) {
          resp.data.avatar = resp.data.avatar || '__static__/wap/img/touxi.png';
          setStorage(getClientType() + 'mission', resp.data);
          that.mission = resp.data[0];
        })
      }
    })

    function aa() {
      console.log(app.data)
    }
    // 获取url"?"后参数
    function getQueryString(name) {
      var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
      var r = window.location.search.substr(1).match(reg);
      if (r != null) {
        return unescape(r[2]);
      }
      return null;
    }
  </script>
</body>

</html>