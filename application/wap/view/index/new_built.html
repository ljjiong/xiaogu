<!-- 新建html模板页 -->

<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport"
    content="initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=no, width=device-width">
  <meta name="keywords" content="wancllshop">
  <title></title>
  <!-- 公共资源文件引入 -->
  <link rel="stylesheet" href="__static__/common/css/loading.css" type="text/css">

  <link rel="stylesheet" href="__static__/wap/aui/css/aui.css" type="text/css">
  <link rel="stylesheet" href="__static__/wap/css/wap.css" type="text/css">
  <link rel="stylesheet" type="text/css" href="__static__/wap/aui/css/aui-flex.css" />

  <!-- 图标库 -->
  <link rel="stylesheet" type="text/css" href="__static__/common/css/ali_icon/iconfont.css" />

  <script src="__static__/jquery-3.2.1.min.js" type="text/javascript"></script>
  <script src="__static__/layer-v3.1.1/layer/layer.js" type="text/javascript"></script>
  <script src="__static__/vue/vue-2.5.15/vue.min.js" type="text/javascript"></script>


  <script src="__static__/common/script/common.js" type="text/javascript"></script>
  <script src="__static__/common/script/config.js" type="text/javascript"></script>
  <script src="__static__/common/script/wapRouter.js" type="text/javascript"></script>

  <script src="__static__/axios/axios.min.js"></script>
  <script src="__static__/common/script/httpPromise.js"></script>
  <link rel="icon" id="icon-img" href="" type="image/x-icon" />


  <!-- <script>
    document.title = getStorage('systemParams').system_title || ''
    document.getElementById("icon-img").href = getStorage('systemParams').web_icon;
  </script> -->
  <script src="__static__/wap/aui/script/aui-actionsheet.js"></script>
  <link rel="stylesheet" href="__static__/wap/css/normalize3.0.2.min.css" />
  <link rel="stylesheet" href="__static__/wap/css/style.css?v=7" />
  <link href="__static__/wap/css/mobiscroll.css" rel="stylesheet" />
  <link href="__static__/wap/css/mobiscroll_date.css" rel="stylesheet" />
  <style type="text/css">
    body {
      background-color: #fff;
    }

    ::-webkit-input-placeholder {
      /* WebKit browsers */
      color: #9e9e9e !important;
    }

    :-moz-placeholder {
      /* Mozilla Firefox 4 to 18 */
      color: #9e9e9e !important;
    }

    ::-moz-placeholder {
      /* Mozilla Firefox 19+ */
      color: #9e9e9e !important;
    }

    :-ms-input-placeholder {
      /* Internet Explorer 10+ */
      color: #9e9e9e !important;
    }

    .logo-width {
      width: 50%;
    }

    .search-detail {
      background: #f5f5f5;
      border-radius: 5rem
    }

    .aui-bar-nav .aui-resetting-title {
      right: 2rem;
      left: 4rem
    }

    .department-item .department-title {
      background-color: #eeeeee;
      height: 22px;
      line-height: 22px;
      color: #999999;
    }

    .department-item .man-item {
      display: flex;
      border-bottom: 1px solid #eeeeee;
      justify-content: space-between;
      align-items: center
    }

    .department-item .man-item .one {
      width: 46px;
      height: 46px;
      line-height: 46px;
      border-radius: 100%;
      text-align: center;
      color: #555555;
      background-color: #eeeeee;
    }

    .department-item .man-item .two {
      text-align: left;
      flex: 1;
    }

    .department-item .man-item .three {
      color: #555555 !important;
    }

    .new-built-input {
      display: flex;
      /*align-items: center;*/
    }

    .new-built-input .left-cont {
      width: 4.6rem;
      height: 2.2rem;
      line-height: 2.2rem;
    }

    .new-built-input .right-cont {
      flex: 1;
      position: relative;
    }

    .new-built-input .right-cont .input {
      width: 100%;
      border-radius: 15px;
      background-color: #eeeeee;
      box-sizing: border-box;
      position: relative;
      display: flex;
      align-items: center;
    }

    .new-built-input .right-cont .input:after {
      content: "";
      display: block;
      clear: both;
    }

    .new-built-input .right-cont .input img {
      position: absolute;
      right: 0.5rem;
      width: 16px;
      height: auto;
      top: 50%;
      margin-top: -8px;
    }

    .new-built-input .right-cont .textarea {
      width: 100%;
      border-radius: 15px;
      background-color: #eeeeee;
      box-sizing: border-box;
      height: auto;
      padding: 0.5rem;
    }

    .new-built-input .select-cont:after {
      content: "";
      position: absolute;
      width: 16px;
      height: 16px;
      right: 0.5rem;
      top: 50%;
      margin-top: -8px;
      background: url(__static__/wap/img/select.png);
      background-size: cover;
    }

    .selcet-content {
      position: fixed;
      bottom: 0.75rem;
      left: 0.75rem;
      right: 0.75rem;
      padding: 0.5rem;
      border: 2px solid rgb(231, 81, 81);
      background-color: #fff;
      border-radius: 15px;
      display: flex;
      flex-wrap: wrap;
    }

    .selcet-content div {
      padding: 0.2rem;
    }

    .man-name {
      float: left;
      line-height: 2.2rem;
    }

    .close-btn {
      width: 100%;
      display: flex;
      justify-content: flex-end;
      color: #e75151;
    }

    .aui-label {
      padding: 0.2em 0.25em;
      font-size: 0.6rem;
      color: #616161;
      background-color: #f4f4f4;
      text-align: center;
      white-space: nowrap;
      vertical-align: middle;
      border-radius: 0.15em;
      position: relative;
    }

    .aa {
      width: 100%;
      height: 300px;
      overflow-y: scroll;
      float: left;
    }

    .bb {
      width: 20%;
    }
  </style>
</head>

<body>
  <div id="app">
    <header class="aui-bar aui-bar-nav aui-bar-light" id="header" style="background-image:none;margin-top: 1rem;">
      <a class="aui-pull-left aui-btn" style="color: #333333" onclick="javascript:window.history.back(); return false;">
        取消
      </a>
      <div class="aui-title" v-text="title"></div>
      <a class="aui-pull-right aui-btn" style="color: #e75151" @click="sublimit()">
        完成
      </a>
    </header>
    <!-- 中间页 -->
    <div class="aui-content aui-padded-t-15 aui-padded-l-15 aui-padded-r-15">
      <div class="new-built-input aui-margin-b-15 aui-padded-b-10">
        <div class="left-cont aui-font-size-14">
          任务名称
        </div>
        <div class="right-cont ">
          <!-- <input class="input aui-padded-l-15 aui-padded-r-15" type="text" name=""> -->
          <div class="input aui-padded-l-15 aui-padded-r-15" style="min-height: 2.2rem;">
            <input id="project_name" class="input aui-padded-l-15 aui-padded-r-15" type="text" name="">
          </div>
        </div>
      </div>
      <div class="new-built-input aui-margin-b-15 aui-padded-b-10">
        <div class="left-cont aui-font-size-14">
          任务说明
        </div>
        <div class="right-cont ">
          <textarea rows="5" id="project_details" class="textarea aui-padded-l-15 aui-padded-r-15"></textarea>
        </div>
      </div>
      <div class="new-built-input aui-margin-b-15 aui-padded-b-10">
        <div class="left-cont aui-font-size-14">
          任务负责人
        </div>
        <div class="right-cont ">
          <div class="input aui-padded-l-15 aui-padded-r-15" style="min-height: 2.2rem;">
            <div @click="removeMan(mansKey)" v-for="(mans,mansKey) in man" :key="mansKey"
              class="aui-font-size-14 aui-padded-r-15 man-name" :principal="principal" v-text="mans">
              {{mans.nick_name}}</div>
            <img @click="showChose" src="__static__/wap/img/add.png">
          </div>
        </div>
      </div>
      <div class="new-built-input aui-margin-b-15 aui-padded-b-10">
        <div class="left-cont aui-font-size-14">
          任务参与人
        </div>
        <div class="right-cont ">
          <div class="input aui-padded-l-15 aui-padded-r-15" style="min-height: 2.2rem;display: block;height: auto;">
            <div @click="removeParticipant(participantKey)" v-for="(participant,participantKey) in participantList"
              :key="participantKey" class="aui-font-size-14 aui-padded-r-15 man-name" :principal="principal"
              id="canyuren" v-text="participant">
              {{participant.nick_name}}</div>
            <img @click="showChose1" src="__static__/wap/img/add.png">
          </div>
        </div>
      </div>
      <div class="new-built-input aui-margin-b-15 aui-padded-b-10">
        <div class="left-cont aui-font-size-14">
          是否紧急
        </div>
        <div class="right-cont select-cont">
          <select id="is_urgency" class="input aui-padded-l-15 aui-padded-r-15">
            <option></option>
            <option value="0">不紧急</option>
            <option value="1">紧急</option>
          </select>
        </div>
      </div>
      <div class="new-built-input aui-margin-b-15 aui-padded-b-10">
        <div class="left-cont aui-font-size-14">
          任务状态
        </div>
        <div class="right-cont select-cont">
          <select id="states" class="input aui-padded-l-15 aui-padded-r-15">
            <option></option>
            <option value="0">待办工作</option>
            <option value="1">已办工作</option>
            <option value="2">出差</option>
          </select>
        </div>
      </div>
      <div class="new-built-input aui-margin-b-15 aui-padded-b-10">
        <div class="left-cont aui-font-size-14">
          结束时间
        </div>
        <div class="right-cont ">
          <div class="input aui-padded-l-15 aui-padded-r-15" style="min-height: 2.2rem;">
            <input type="text" name="end_time" id="end_time" readonly class="input" />
          </div>
          <!-- <div class="input aui-padded-l-15 aui-padded-r-15" style="min-height: 2.2rem;">
              <div @click="removeMan(mansKey)" v-for="(mans,mansKey) in man" :key="mansKey"
                class="aui-font-size-14 aui-padded-r-15 man-name" v-text="mans">{{mans.nick_name}}</div>
              <img @click="showChose" src="__static__/wap/img/add.png">
            </div> -->
        </div>
      </div>
    </div>
    <!-- 负责人选择div -->
    <div class="selcet-content" v-show="onShow">
      <div class="aui-row close-btn" @click="showChose">
        <span>关闭</span>
      </div>
      <div class="aui-row close-btn">
        <header class="aui-bar aui-bar-nav">
          <div class="aui-resetting-title aui-title " style="left:0;right:5rem;width: 100%;">
            <div class="aui-searchbar aui-bg-white" id="search">
              <div class="aui-searchbar-input aui-border-radius search-detail"
                style="height: 1.74rem;line-height: 1.74rem;">
                <i class="aui-iconfont aui-icon-search"></i>
                <input type="search" placeholder="请输入搜索内容" id="search-input" onkeyup="searchKeyup(event)">
                <div class="aui-searchbar-clear-btn">
                  <i class="aui-iconfont aui-icon-close" style="line-height: 1.4rem"></i>
                </div>
              </div>
              <div class="aui-searchbar-btn" tapmode>取消</div>
            </div>
          </div>
        </header>
      </div>
      <div class="aa">
        <div class="aui-label" v-for="man in user" @click="addman(man.nick_name,man.id);showChose()"
          style="margin: 5px;">
          <span v-show="man.nick_name != ''">{{man.nick_name}}</span>
          <span v-show="man.nick_name == ''">匿名</span>
        </div>
      </div>
    </div>
    <!-- 参与人选择div -->
    <div class="selcet-content" v-show="onShow1">
      <div class="aui-row close-btn">
        <span @click="allunChose" style="margin-right: 0.5rem;">全不选</span>
        <span @click="allChose" style="margin-right: 0.5rem;">全选</span>
        <span @click="showChose1">关闭</span>
      </div>
      <div class="aui-row close-btn">
        <header class="aui-bar aui-bar-nav">
          <div class="aui-resetting-title aui-title " style="left:0;right:5rem;width: 100%;">
            <div class="aui-searchbar aui-bg-white" id="search2">
              <div class="aui-searchbar-input aui-border-radius search-detail"
                style="height: 1.74rem;line-height: 1.74rem;">
                <i class="aui-iconfont aui-icon-search"></i>
                <input type="search" placeholder="请输入搜索内容" id="search-input2" onkeyup="searchKeyup(event)">
                <div class="aui-searchbar-clear-btn">
                  <i class="aui-iconfont aui-icon-close" style="line-height: 1.4rem"></i>
                </div>
              </div>
              <div class="aui-searchbar-btn" tapmode>取消</div>
            </div>
          </div>
        </header>
      </div>
      <div class="aa">
        <div class="aui-label" v-for="participant in user" @click="addParticipant(participant.nick_name,participant.id)"
          style="margin: 5px;">
          <span v-show="participant.nick_name != ''">{{participant.nick_name}}</span>
          <span v-show="participant.nick_name == ''">匿名</span>
        </div>
      </div>
    </div>
    <!-- <div class="selcet-content" v-show="onShow1">
      <div class="aui-font-size-14" v-for="name in list" @click="addproject(name.project_name)">{{name.project_name}}
      </div> -->
    <!-- <div class="aui-font-size-14" @click="addman(' ')"> </div>
      <div class="aui-font-size-14" @click="addman(' ')"> </div>
      <div class="aui-font-size-14" @click="addman(' ')"> </div> -->
    <!-- </div> -->
  </div>
  <script src="__static__/wap/script/mobiscroll_date.js" charset="gb2312"></script>
  <script src="__static__/wap/script/mobiscroll.js"></script>
  <script>
    var actionsheet = new auiActionsheet();
    var app = new Vue({
      el: '#app',
      data: {
        title: '新建任务',
        man: [],
        // 参与人数组
        participantList: [],
        item: [],
        project: [],
        onShow: false,
        onShow1: false,
        project_manager: '',
        principal: '',
        // 参与人id数组
        participant: [],
        save: '',
        list: '',
        genders: ['保密', '男', '女'],
        user: ''
      },
      methods: {
        // 搜索查询
        search(e) {
          console.log(e);
          var that = this;
          //this.getParams()
          that.index = '';
          httpRequest('POST', 'api_users/users/index  ', {
            nick_name: e
          }).then(function (resp) {
            that.user = resp.data;
            // classification(resp.data);
          })
        },
        // 全选按钮
        allChose: function () {
          this.participant = [];
          for (var i = 0; i < this.user.length; i++) {
            this.participant.push(this.user[i].id);
          }
          this.participantList = [];
          this.participantList.push('已全选');
          layer.msg('全选成功');
          // this.participantList.push(name);
          // layer.msg('添加 ' + name + ' 成功');
        },
        // 全不选按钮
        allunChose: function () {
          this.participant = [];
          this.participantList = [];
          layer.msg('取消全选');
          // this.participantList.push(name);
          // layer.msg('添加 ' + name + ' 成功');
        },
        // 显示选择框
        showChose: function () {
          var that = this;
          if (that.onShow == false) {
            that.onShow = true
          } else {
            that.onShow = false
            httpRequest('POST', 'api_users/users/index').then(function (resp) {
              that.user = [];
              that.user = resp.data;
            });
          }
        },
        showChose1: function () {
          var that = this;
          if (that.onShow1 == false) {
            that.onShow1 = true
          } else {
            that.onShow1 = false
            httpRequest('POST', 'api_users/users/index').then(function (resp) {
              that.user = [];
              that.user = resp.data;
            });
          }
        },
        // 添加负责人
        addman: function (name, id) {
          if (this.man.indexOf(name) > -1) {
            console.log(this.man)
          } else {
            this.principal = id;
            this.man = [];
            this.man.push(name)
          }
        },
        addParticipant: function (name, id) {
          if (this.participantList.indexOf(name) > -1) {
            console.log(this.man)
          } else {
            this.participant.push(id);
            this.participantList.push(name);
            layer.msg('添加 ' + name + ' 成功');
          }
        },
        // 移除负责人
        removeMan: function (index) {
          this.man.splice(index, 1)
          this.principal = ''
        },
        // 移除参与人
        removeParticipant: function (index) {
          console.log(this.participantList);
          if (this.participantList.indexOf("已全选") != -1) {
            this.participant = [];
            this.participantList = [];
            layer.msg('取消全选');
          } else {
            this.participant.splice(index, 1)
            this.participantList.splice(index, 1)
            layer.msg('移除成功');
          }
        },
        // 添加任务
        addproject: function (name) {
          console.log(name)
          if (this.item.indexOf(name) > -1) {
            console.log(this.item.name)
          } else {
            this.item = [];
            this.item.push(name)
          }
        },
        // 移除任务
        removeproject: function (index) {
          console.log(index)
          this.item.splice(index, 1)
        },
        // 完成提交
        sublimit() {
          let project_name = $("#project_name").val(),
            project_details = $("#project_details").val(),
            is_urgency = $("#is_urgency").val(),
            states = $("#states").val(),
            project_manager = app.principal,
            project_member = app.participant,
            end_time = $("#end_time").val();
          if (project_name == '' || project_details == '' || project_manager == '' || project_member ==
            '' ||
            is_urgency == '' || end_time == '' || states == '') {
            let postData = {
              project_name: project_name,
              task: project_details,
              project_manager: project_manager,
              project_member: project_member,
              is_urgency: tobenumber(is_urgency),
              states: tobenumber(states),
              end_time: end_time
            }
            console.log(postData);
            layer.msg('请完善表格');
          } else {
            let postData = {
              project_name: project_name,
              task: project_details,
              project_manager: project_manager,
              project_member: project_member,
              is_urgency: tobenumber(is_urgency),
              states: tobenumber(states),
              end_time: end_time
            }
            console.log(postData);
            // plus.push.createMessage('欢迎使用Html5 Plus创建本地消息！');
            httpRequest('POST', 'api_project/project_detail/save', postData).then(function (resp) {
              layer.msg('提交成功', function () {
                javascript: window.history.back();
                return false;
              });
            })
          }
        }
      },
      computed: {

      },
      filters: {

      },
      mounted: function () {
        var that = this;
        //this.getParams()
        httpRequest('POST', 'api_users/users/index').then(function (resp) {
          that.user = resp.data;
        });
      },
    })
    // 返回任务名称
    function returnList() {
      let appList = [];
      for (let i = 0; i < app.list.length; i++) {
        appList.push(app.list[i].project_name)
      }
      return appList
    }
    // 负责人搜索方法
    var searchBar = document.querySelector(".aui-searchbar");
    var searchBarInput = document.querySelector(".aui-searchbar input");
    var searchBarBtn = document.querySelector(".aui-searchbar .aui-searchbar-btn");
    var searchBarClearBtn = document.querySelector(".aui-searchbar .aui-searchbar-clear-btn");
    if (searchBar) {
      searchBarInput.onclick = function () {
        searchBarBtn.style.marginRight = 0;
      }
      searchBarInput.oninput = function () {
        if (this.value.length) {
          searchBarClearBtn.style.display = 'block';
          searchBarBtn.classList.add("aui-text-default");
          searchBarBtn.textContent = "搜索";
        } else {
          searchBarClearBtn.style.display = 'none';
          searchBarBtn.classList.remove("aui-text-info");
          searchBarBtn.textContent = "取消";
        }
      }
    }
    searchBarClearBtn.onclick = function () {
      this.style.display = 'none';
      searchBarInput.value = '';
      searchBarBtn.classList.remove("aui-text-info");
      searchBarBtn.textContent = "取消";
    }
    searchBarBtn.onclick = function () {
      var keywords = searchBarInput.value;
      if (keywords.length) {
        searchBarInput.blur();
        app.search(keywords)
      } else {
        this.style.marginRight = "-" + this.offsetWidth + "px";
        searchBarInput.value = '';
        searchBarInput.blur();
      }
    }
    // 参与人搜索方法
    var searchBar1 = document.querySelector("#search2");
    var searchBarInput1 = document.querySelector("#search2 input");
    var searchBarBtn1 = document.querySelector("#search2 .aui-searchbar-btn");
    var searchBarClearBtn1 = document.querySelector("#search2 .aui-searchbar-clear-btn");
    if (searchBar1) {
      searchBarInput1.onclick = function () {
        searchBarBtn1.style.marginRight = 0;
      }
      searchBarInput1.oninput = function () {
        if (this.value.length) {
          searchBarClearBtn1.style.display = 'block';
          searchBarBtn1.classList.add("aui-text-default");
          searchBarBtn1.textContent = "搜索";
        } else {
          searchBarClearBtn1.style.display = 'none';
          searchBarBtn1.classList.remove("aui-text-info");
          searchBarBtn1.textContent = "取消";
        }
      }
    }
    searchBarClearBtn1.onclick = function () {
      this.style.display = 'none';
      searchBarInput1.value = '';
      searchBarBtn1.classList.remove("aui-text-info");
      searchBarBtn1.textContent = "取消";
    }
    searchBarBtn1.onclick = function () {
      var keywords = searchBarInput1.value;
      if (keywords.length) {
        searchBarInput1.blur();
        app.search(keywords)
      } else {
        this.style.marginRight = "-" + this.offsetWidth + "px";
        searchBarInput1.value = '';
        searchBarInput1.blur();
      }
    }
    // 转数字类型
    function tobenumber(event) {
      if (event == '') {
        return '';
      } else {
        return parseInt(event);
      }
    }

    function searchKeyup(event) {
      if (event.keyCode == 13) {
        searchBarBtn.click()
      }
    }
    // 初始化时间选择器
    $(function () {
      $("#view_dpartment").val(user.department)
      var currYear = (new Date()).getFullYear();
      var opt = {};
      opt.date = {
        preset: 'date'
      };
      opt.datetime = {
        preset: 'datetime'
      };
      opt.time = {
        preset: 'time'
      };
      opt.default = {
        theme: 'android-ics light', //皮肤样式
        display: 'modal', //显示方式 
        mode: 'scroller', //日期选择模式
        dateFormat: 'yyyy-mm-dd',
        lang: 'zh',
        showNow: true,
        nowText: "今天",
        startYear: currYear - 50, //开始年份
        endYear: currYear + 10 //结束年份
      };
      $("#create_time").mobiscroll($.extend(opt['date'], opt['default']));
      $("#end_time").mobiscroll($.extend(opt['date'], opt['default']));

    });
  </script>
</body>

</html>