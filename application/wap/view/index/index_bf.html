<!-- 新建html模板页 -->

<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=no, width=device-width">
  <meta name="keywords" content="wancllshop">
  <title></title>
  <!-- 公共资源文件引入 -->
  <link rel="stylesheet" href="__static__/common/css/loading.css" type="text/css">

  <link rel="stylesheet" href="__static__/wap/aui/css/aui.css" type="text/css">
  <link rel="stylesheet" href="__static__/wap/css/wap.css" type="text/css">
  <link rel="stylesheet" type="text/css" href="__static__/wap/aui/css/aui-flex.css" />

  <!-- 图标库 -->
  <link rel="stylesheet" type="text/css" href="__static__/common/css/ali_icon/iconfont.css" />

  <script src="__static__/jquery-3.2.1.min.js" type="text/javascript"></script>
  <script src="__static__/layer-v3.1.1/layer/layer.js" type="text/javascript"></script>
  <script src="__static__/vue/vue-2.5.15/vue.min.js" type="text/javascript"></script>


  <script src="__static__/common/script/common.js" type="text/javascript"></script>
  <script src="__static__/common/script/config.js" type="text/javascript"></script>
  <script src="__static__/common/script/wapRouter.js" type="text/javascript"></script>

  <script src="__static__/axios/axios.min.js"></script>
  <script src="__static__/common/script/httpPromise.js"></script>
  <link rel="icon" id="icon-img" href="" type="image/x-icon"/>


  <!-- <script>
    document.title = getStorage('systemParams').system_title || ''
    document.getElementById("icon-img").href = getStorage('systemParams').web_icon;
  </script> -->
<link rel="stylesheet" href="__static__/OwlCarousel2-2.2.1/assets/owl.carousel.min.css">
<link rel="stylesheet" href="__static__/OwlCarousel2-2.2.1/assets/owl.theme.default.min.css">
<script src="__static__/OwlCarousel2-2.2.1/owl.carousel.min.js"></script>
<script src="__static__/wap/aui/script/aui-actionsheet.js"></script>
<script src="__static__/wap/script/index.js"></script>
<style>
  ::-webkit-input-placeholder {
    /* WebKit browsers */
    color: #9e9e9e !important;
  }

  :-moz-placeholder {
    /* Mozilla Firefox 4 to 18 */
    color: #9e9e9e !important;
  }

  ::-moz-placeholder {
    /* Mozilla Firefox 19+ */
    color: #9e9e9e !important;
  }

  :-ms-input-placeholder {
    /* Internet Explorer 10+ */
    color: #9e9e9e !important;
  }

  .logo-width{
      width:50%;
   }
  .search-detail{
    background: #f5f5f5;border-radius:5rem
  }
  .aui-bar-nav .aui-resetting-title
  {
    right:2rem;
    left:4rem
  }

  .owl-theme .owl-nav.disabled+.owl-dots {
    position: absolute;
    bottom: 1rem;
    width: 100%;
  }

  .owl-theme .owl-dots .owl-dot span {
    width: 8px;
    height: 8px;
    border-radius: 8px;
    background-color: #f4f4f4;

  }
  .dot {
    width: 0.2rem;
    height: 0.2rem;
    background-color: #757575;
    border-radius: 0.2rem;
  }

  .owl-theme .owl-dots .owl-dot.active span,
  .owl-theme .owl-dots .owl-dot:hover span {
    background-color: #369eff;
  }
  #xianshizhekou
  {
    width:90%;
    margin:0 auto;
  }
  #xianshizhekou .owl-dots {
    display: none;
  }
  .product-tag{
    position: relative;
    z-index:3;
    width:100%;
    margin-top:-2rem;
  }
 .product-tag{
   background: url('__static__/wap/images/tag_bg.png');
   background-size:100%;
   border-bottom: 1px solid #f5f5f5;
 }
  .aui-grid{
    background: none;
  }
  #top {
    background:#fff;
  }
  .aui-grid .aui-grid-label {
    color: #504b4b;
    margin-top: 0;
  }
  .aui-grid [class*=aui-col-] {
    padding: .2rem .2rem;
  }
  .aui-col-xs-2 {
    width: 20%; 
  }
  #search-header {
    background: linear-gradient(to bottom, #57b8f7, #53b1f8, #4facf9);
  }
  .aui-grid [class*=aui-col-] {
    padding: 0rem;
  }
  .shouxin {
    position: absolute;
    top: 40%;
    left: 50%;
    width: 30%;
    transform: translate(-50%, -50%);
  }
  .hot-tag{
    border-radius: .5rem;
    margin-right: .3rem;
    border: 1px solid red;
    color: red;
    padding: .1rem .2rem;

  }
  .annoncements-border{
    border-bottom:10px solid #f5f5f5;
  }
  .aui-label-outlined.aui-label-danger, .aui-label-outlined.aui-label-danger:after
  {
    border-radius: 10px;
  }
  .coupon_list{
      width:100%;
      background: url('__static__/wap/images/yhqbg.png') no-repeat;
      background-size: 100%;
  }
  .coupon_list ul
  {
    width:72%;
    margin:0 auto;
  }
  .coupon_list ul li{
     width:25%;
     background: url('__static__/wap/images/yhq.png') no-repeat;
     background-size: 100%;
     float: left;
     color:#fe0d2e;
  }
  .discount_list
  {
      width:100%;
      background: url('__static__/wap/images/xszkbg.png') no-repeat;
      background-size: 100%;   
  }
  .discount_time{
    margin-left: 112.5px;
    padding-top:21.5px;
  }
  .discount_time span{
    background:#000;
    color:#fff;
    padding: 2px;
    font-size:12px;
  }
    .discount_time label{
      font-weight: 600;
      padding-left:5px;
    }

   .points-lists
   {
     position: absolute;
   } 
   .points-info{
    position:relative ;
   }
   .go-collage{
      background: #4f8aeb;
      color: #fff;
      padding: 0.1rem 0.3rem;
      border-radius: 10%;
   }
   #xinpinhuodong .owl-dots,
   #jifenduihuan .owl-dots
   {
     display: none;
   }
   .pink-color{
    color:#f7568f;
   }
   .border-radius-2
   {
    border-radius: 2px;
   }
   .owl-carousel .owl-item img.icon{
    max-width: 12px;
    display: inline;
   }
   .choice-price{
      background: #f93232;
      color:#fff;
      width:80%;
      margin:0 auto;
      border-radius:5rem;
     
   }
   .tuangou-item{
     height: 1.89rem
   }
@media only screen and (min-width:319px) { 
  .hot-content{
    font-size:13px;
  }
  .hot-tag{
    font-size:12px;
  }
  .discount_time span{
    font-size:10px;
    padding: 2px 1px 0px 1px;
  }
    .tuangou-item{
     height: 1.6rem
  }
}
@media only screen and (min-width:359px) { 

  .hot-content{
    font-size:13px;
  }
    .hot-tag{
    font-size:12px;
  }
  .discount_time span{
    font-size:10px;
    padding: 2px 1px 0px 1px;
  }
  .tuangou-item{
     height: 1.89rem
  }

}
@media only screen and (min-width:374px) { 
  .hot-content{
    font-size:13px;
  }
  .hot-tag{
    font-size:12px;
  }
    .discount_time span{
    font-size:10px;
    padding: 2px 1px 0px 1px;
  }
     .tuangou-item{
     height: 1.89rem
  }
}   
</style>

</head>

<body>
  <div id="app">
    <!-- 头部 -->
    <div id="top">
      <header class="aui-bar aui-bar-nav">
          <a class="aui-pull-left aui-btn">
              <img :src="logo" class="logo-width" v-if="logo">
          </a>
          <div class="aui-resetting-title aui-title " >
            <div class="aui-searchbar aui-bg-white" id="search" onclick="gotowap('search_page')">
                <div class="aui-searchbar-input aui-border-radius search-detail "   tapmode onclick="doSearch()">
                    <i class="aui-iconfont aui-icon-search "></i>
                    <form action="javascript:search();">
                        <input type="search" placeholder="请输入搜索内容" id="search-input">
                    </form>
                </div>
            </div>
          </div>
          <a class="aui-pull-right aui-btn aui-btn-outlined">
              <i class="aui-iconfont aui-icon-comment" @click="gotowap('article_list', {type: 'annoncements'})"></i>
          </a>
      </header>
    <!-- 中间页 -->
    <div class="aui-content" style="margin-bottom:2.8rem;">
      <!-- 轮播 -->
      <div class="owl-carousel owl-theme" id="owl-carousel1">
        <div class="item" v-for="(banner,key) in banners" :key="key">
          <a :href="banner.href">
            <img :src="banner.img" />
          </a>
        </div>
      </div>
     <!--产品标签-->
      <div class="product-tag aui-padded-t-15">
        <section class="aui-grid aui-padded-t-15 aui-padded-b-15">
          <div class="aui-row aui-margin-l-5 aui-margin-r-5">
            <div class="aui-col-xs-2" v-for="(tag,tagKey) in tags" :key="tagKey" @click="goGoodsList(tag)">
              <img :src="tag.thum" class="aui-padded-5" style="margin:0 auto;">
              <div class="aui-grid-label" v-text="tag.name"></div>
            </div>
          </div>
        </section>
      </div>
      <!-- 公告 -->
      <div class="aui-padded-l-10 aui-padded-r-10 aui-bg-white annoncements-border" v-if="annoncements.length != 0">
        <div class="aui-list aui-media-list " style="background-image:none;border-radius: .2rem">
          <div class="aui-media-list-item-inner">
            <div class="aui-list-item-media aui-text-center" style="width:25%;padding-right: 0.5rem;">
              <img src="__static__/wap/images/wangkaikuaibao.png" style="width:60%;margin:0 auto;">
            </div>
            <div class="aui-list-item-inner" style="width:75%;">
              <div class="aui-list-item-text-right" v-for="(annoncement,annoncementKey) in annoncements" :key="annoncementKey"
                @click="goAnnoncements(annoncement)" v-if="annoncementKey < 2">
                <div class="aui-list-item-text" style="line-height:1.2rem;">
                  <div class="aui-label  hot-tag">热门</div>
                  <div class="aui-ellipsis-1 hot-content" style="width:95%;color:#5c5c5c" v-text="annoncement.title"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!--优惠券信息-->
      <div class="coupon_list" id="coupon_list" v-if="coupons.length != 0" onclick="gotowap('coupon')">
          <ul>
              <li v-for="(coupon,couponKey) in coupons" :key="couponKey" v-if="couponKey<4">
                   <div class="aui-text-center coupons_info" v-if="coupon.coupon_type == 'discount'">
                    <span class="discount_money aui-font-weight" v-text="coupon.change_value"></span>
                    <span class="discount_money_tag">折</span>
                  </div>
                  <div class="aui-text-center coupons_info" v-else="coupon.coupon_type == 'full'">
                    <span class="discount_money_tag">¥</span>
                    <span class="discount_money aui-font-weight" v-text="coupon.change_value"></span>
                     
                  </div>
                  <div v-if="coupon.coupon_type == 'discount'" class="coupon-infotext aui-text-center" v-text="'满' + coupon.reach_money + '元'"></div>
                  <div v-if="coupon.coupon_type == 'full'" class="coupon-infotext aui-text-center" v-text="'满¥' + coupon.reach_money + '可用'"></div>
              </li>                          
          </ul> 
      </div>
      <!--限时折扣-->
      <div class="discount_list" v-if="discountActivity.rule_info.length>0"> 
         <div class="discount_time " onclick="gotowap('discount_page')">
             <span> {{discountActivity.deadline | timeFilterday}} </span> <label>:</label> 
             <span> {{discountActivity.deadline | timeFilterhour}} </span> <label>: </label> 
             <span> {{discountActivity.deadline | timeFilterminute}} </span> <label>: </label> 
             <span> {{discountActivity.deadline | timeFiltersecond}} </span>
         </div>   

        <!-- 折扣轮播商品 -->
        <div class="owl-carousel owl-theme aui-padded-t-5" id="xianshizhekou" >
          <div class="item aui-bg-white" v-for="(rule, key) in discountActivity.rule_info " :key="key " style="margin: 4px;border-radius: 2px ">
            <a :href="rule.href">
              <img :src="rule.goods_info.thum" style="border-radius:2px 2px 0 0;"/>
              <div class="aui-font-size-12 aui-text-price aui-text-center">
                <span class="aui-font-size-12 pink-color" style="font-size:0.5rem; ">¥</span>
                <span class="pink-color" v-text="rule.discount_price"></span>
                <span style="font-size:0.5rem;text-decoration: line-through;color:#cacaca">
                ¥<span v-text="rule.goods_info.sell_price"></span></span>
              </div>
            </a>
          </div>
        </div>
      </div>
      <!--积分兑换-->
      <div class="aui-padded-t-15" v-if="scoregoods.length != 0">
           <img src="__static__/wap/images/jfdh.png" onclick="gotowap('score_shop')"/>
           <div class="points-lists" >
              <img src="__static__/wap/images/zkbg.jpg"/>             
           </div>
           <div class="points-info" style="width:115%">
            <div class="owl-carousel owl-theme aui-padded-b-15 aui-padded-t-5" id="jifenduihuan">
              <div class="item aui-bg-white border-radius-2" v-for="(goods, key) in scoregoods" :key="key " v-if="goods.id" style="margin: 4px;  " @click="goScoreGoodsDetail(goods)">
                  <img :src="goods.goods_info.thum"  style="border-radius:2px 2px 0 0;"/>
                  <p class="aui-padded-l-10 aui-padded-r-10 aui-bg-white aui-text-center">
                    <img src="__static__/wap/images/icon.png" class="icon"/>
                    <span class="aui-text-price" v-text="goods.score"></span>
                    <span class="aui-text-price aui-font-size-10">积分</span>
                    <span v-if="goods.money > 0" class="aui-text-price aui-font-size-10">+</span>
                    <span v-if="goods.money > 0" class="aui-text-price" v-text="goods.money"></span>
                    <span v-if="goods.money > 0" class="aui-text-price aui-font-size-10">¥</span>
                  </p>
                  <h5 style="height: 1.8rem;border-radius:0px 0px 2px 2px;" class=" aui-text-center aui-text-default aui-ellipsis-2 aui-font-size-10  aui-padded-l-5 aui-padded-r-5
                      aui-bg-white "
                    v-text="goods.goods_info.name"></h5>
              </div>
              <div v-else>&nbsp;</div>         
            </div>         
          </div> 
      </div>
      <!--一起拼团-->
      <div class="aui-padded-t-5" v-if="groupgoods.length != 0">
          <img src="__static__/wap/images/pingtuan.jpg" onclick="gotowap('group_shop')"/>
          <div class="points-lists" >
              <img src="__static__/wap/images/tuangoubg.jpg"/>             
          </div>
          <div class="points-info">
              <section class="aui-grid aui-padded-t-10 aui-padded-b-10">
                  <div class="aui-row aui-margin-l-5 aui-margin-r-5">
                       <div class="aui-col-xs-6 " v-for="(goods,goodsKey) in groupgoods" :key="goodsKey" v-if="goodsKey<4"  @click="goGroupGoodsDetail(goods)">
                          <div class="aui-row  aui-margin-5 aui-bg-white" style="border-radius: 4px;">
                              <div class="aui-col-xs-5">
                                  <div class="aui-list-item-media">
                                    <img :src="goods.goods_info && goods.goods_info.thum"  class="aui-margin-5"/>
                                  </div>
                              </div>
                              <div class="aui-col-xs-7">
                                  <div class="aui-list-item-inner aui-padded-l-10 aui-padded-t-5 aui-padded-r-5   aui-text-left">
                                    <!-- 商品名称 -->
                                    <div class="aui-list-item-text tuangou-item">
                                      <div class="aui-list-item-title aui-ellipsis-2 aui-font-size-10"   v-text="goods.goods_info && goods.goods_info.name">
                                      </div>
                                    </div>
                                    <!-- 商品金额 -->
                                    <div class="aui-list-item-text aui-text-pray ">
                                      <div class="aui-list-item-title aui-font-size-10 " style="color:#cacaca" >
                                        <span>
                                          单买价
                                          <span style="text-decoration:line-through" v-text="'￥' + (goods.goods_info && goods.goods_info.sell_price)"></span>
                                        </span>
                                        <div class="aui-font-size-12" style="color:red">
                                          ¥
                                          <span  v-text="goods.money"></span>
                                        </div>
                                      </div>
                                    </div>
                                  </div>                                  
                              </div>
                          </div>
                       </div>
                  </div>
              </section>
          </div>
      </div>
      <!--精选产品-->
      <div class="aui-padded-t-10" v-if="choicegoods.length != 0">
           <img src="__static__/wap/images/jxcp.png"/>
           <img src="__static__/wap/images/jxcp.jpg" />
           <div class="points-lists" >
              <img src="__static__/wap/images/jxsp.jpg"/>             
           </div>
           <div class="points-info">
                <section class="aui-grid aui-padded-t-10 aui-padded-b-10">
                    <div class="aui-row">
                       <div class="aui-col-xs-3 " v-for="(goods,goodsKey) in choicegoods" :key="goodsKey"  v-if="goodsKey<8"  @click="goGoodsDetail(goods.id)">
                           <div class=" aui-margin-l-5 aui-margin-r-5 aui-margin-t-10"  >
                                <img :src="goods.thum"  style="border-radius:2px 2px 0 0" />
                                <img src="__static__/images/shouxin.png" class="shouxin" v-if="goods.stock == 0">
                                <h5  class="aui-text-default aui-ellipsis-1 aui-font-size-10 aui-padded-l-10 aui-padded-r-10 aui-bg-white"
                                v-text="goods.name"></h5>
                                <div class="aui-padded-b-5  aui-padded-l-10 aui-padded-r-10 aui-bg-white"  style="border-radius: 0 0 2px 2px" >
                                   <div class="choice-price aui-font-size-10">
                                    <span >¥</span>
                                    <span  v-text="goods.sell_price"></span>  
                                   </div>
                                </div>                             
                           </div>
                       </div>
                    </div>
                </section>
           </div>
      </div>
      <!--新品活动-->
       <div class="aui-padded-t-10" v-if="newgoods.length != 0">
           <img src="__static__/wap/images/xphg.png"/>
           <img src="__static__/wap/images/xphd.jpg" />
           <div class="points-lists" >
              <img src="__static__/wap/images/xphdbg.png"/>             
           </div>
           <div class="points-info" style="width:115%">
             <div class="owl-carousel owl-theme aui-padded-b-15 aui-padded-t-15" id="xinpinhuodong" >
                <div class="item aui-bg-white " v-for="(goods, key) in newgoods" :key="key" @click="goGoodsDetail(goods.id)" v-if="goods.id"  style="margin: 4px; border-radius:2px" >
                        <img :src="goods.thum" />
                        <img src="__static__/images/shouxin.png" class="shouxin" v-if="goods.stock == 0" style="width:30%">
                        <h5  class="aui-text-default aui-ellipsis-1 aui-font-size-12 aui-padded-l-10 aui-padded-r-10  aui-bg-white"
                        v-text="goods.name"></h5>
                        <p class="aui-padded-b-5  aui-padded-l-10 aui-padded-r-10 aui-bg-white" style="border-radius:0 0 2px 2px ">
                        <span class="aui-text-price aui-font-size-10">￥</span>
                        <span class="aui-text-price" v-text="goods.sell_price"></span>  
                        </p>   
                </div>
                <div v-else>&nbsp;</div>  
            </div>            
           </div>
        </div>       

      <!-- 商品列表 -->
      <div class="aui-flex-col aui-flex-center aui-padded-t-10">
        <div class="aui-flex-item-12 ">
          <img src="__static__/wap/images/wntj.png" />
          <div class="aui-flex-col ">
            <div class="aui-flex-item-6 " style="position: relative;padding:3px;" @click="goGoodsDetail(goods.id)"
              v-for="(goods,goodsKey) in goodslist" :key="goodsKey ">
              <img :src="goods.thum ">
              <img src="__static__/images/shouxin.png" class="shouxin" v-if="goods.stock == 0">
              <h5 style="height: 2.2rem;" class="aui-text-default aui-ellipsis-2 aui-font-size-14 aui-padded-t-5 aui-padded-l-5 aui-padded-r-5
                aui-bg-white "
                v-text="goods.name"></h5>
              <p class="aui-padded-b-5 aui-padded-t-5 aui-padded-l-10 aui-padded-r-10 aui-bg-white ">
                <span class="aui-text-price aui-font-size-10">￥</span>
                <span class="aui-text-price " v-text="goods.sell_price "></span>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer class="aui-bar aui-bar-tab" id="footer">
  <div class="aui-bar-tab-item" onclick="gotowap('index')" :class="{'icon-footer-active' : (activeFooterIndex == 1 )}">
    <div class="icon-div">
      <img v-if="activeFooterIndex == 1" src="__static__/wap/img/icon12.png">
      <img v-else src="__static__/wap/img/icon11.png">
    </div>
    <div class="aui-bar-tab-label">任务</div>
  </div>
  <div class="aui-bar-tab-item" onclick="gotowap('personnel_page')"
    :class="{'icon-footer-active' : (activeFooterIndex == 2 )}">
    <div class="icon-div">
      <img v-if="activeFooterIndex == 2" src="__static__/wap/img/icon22.png">
      <img v-else src="__static__/wap/img/icon21.png">
    </div>
    <div class="aui-bar-tab-label">行政</div>
  </div>
  <div class="aui-bar-tab-item" onclick="gotowap('home')" :class="{'icon-footer-active' : (activeFooterIndex == 3 )}">
    <!-- <div class="aui-badge">99</div> -->
    <div class="icon-div">
      <img v-if="activeFooterIndex == 3" src="__static__/wap/img/icon32.png">
      <img v-else src="__static__/wap/img/icon31.png">
    </div>
    <div class="aui-bar-tab-label">我的</div>
  </div>
</footer>
  </div>
  <script>
    // 滚动到底部的事件
    function scrollEvent() {
      var scrollTop = document.documentElement.scrollTop || window.pageYOffset || document.body.scrollTop;
      if (document.documentElement.scrollHeight - scrollTop - document.documentElement.clientHeight < 10) {
        app.loadGoods();
      }
    }
    var avatarDom = document.getElementById('avatar');
    if (avatarDom) {
      avatarDom.style.cssText += 'height:' + avatarDom.offsetWidth + 'px;';
    }
    var page = 1;
    var app = new Vue({
      el: '#app',
      data: {
        title: 'title',
        user: user,
        activeFooterIndex: 1,
        banners: [],
        goodslist: [],
        tags: [],
        bannerGoodsList: [],
        coupons:[],
        scoregoods:[],   //积分商品
        groupgoods:[],   //团购商品
        choicegoods:[],  //精选商品
        newgoods:[],    //新品商品
        annoncements: [],
        discountActivity: {
          rule_info: []
        },
        // 广告
        advertisements: [{}],
        // logo
        logo: '',
        group_shop_type: 1, // 1为系统拼团，2为会员拼团
      },
      methods: {
        // 去链接设置的模型
        goModel: function (content) {
          if (content.is_open_model == 1) {
            if (content.model == 'goods') {
              gotowap('goods_detail', { goodsId: content.model_id })
            } else if (content.model == 'article') {
              gotowap('article_detail', { type: 'articles', articleId: content.model_id });
            } else if (content.model == 'goods_cate') {
              gotowap('goods_list');
            }
          } else {
            content.href && (location = content.href);
          }
        },
        // 去商品详情
        goGoodsDetail: function (goodsId) {
          var prePageData = {
            scrollTop: document.documentElement.scrollTop || window.pageYOffset || document.body.scrollTop,
            page: page,
            data: this.goodslist,
          }
          setStorage('preIndexlistPageData', prePageData, sessionStorage);
          gotowap('goods_detail', { goodsId: goodsId })
        },
        //跳转到商品详情
        goScoreGoodsDetail:function(goods){
          gotowap('score_goods_detail', { goodsId: goods.goods_id, id: goods.id })
        },
        //跳转到团购商品详情
        goGroupGoodsDetail:function(goods)
        {
          gotowap('group_goods_detail', { goodsId: goods.goods_id, id: goods.id })
        },
        // 去商品集合
        goGoodsList: function (tag) {
          gotowap('goods_list_model', {
            tag: tag.name
          })
        },
        // 去公告
        goAnnoncements: function (annoncement) {
          gotowap('article_detail', { type: 'annoncements', articleId: annoncement.id });
        },
        // 去广告
        goAd: function (ad) {
          if (ad.model == 'goods') {
            gotowap('goods_detail', { goodsId: ad.model_id });
          } else if (ad.model == 'article') {
            gotowap('article_detail', { articleId: ad.model_id, type: 'articles' });
          } else if (ad.model == 'goods_cate') {
            gotowap('goods_list_model', { cateId: ad.model_id });
          } else {
            location = ad.href;
          }
        },
        // 加载商品
        loadGoods: function () {
          var that = this;
          document.body.onscroll = null;
          httpRequest('POST', 'api_goods/goods/lists', {}, {
            'page-num': page,
            'page-limit': 10
          }).then(function (resp) {
            if (resp.data.length > 0) {
              that.haveNoData = false;
              resp.data.forEach(function (item) {
                that.goodslist.push(item);
              })
              if (resp.data.length == 10) {
                page++;
                document.body.onscroll = scrollEvent;
              } else {
                document.body.onscroll = null;
              }
            } else {
              if (page == 1) {
                that.haveNoData = true;
              }
            }
          });
        },
        getParams: function () {
          var that = this
          httpRequest('POST', 'api_systems/params/getParams', {
            type: 'basic'
          }).then(function (resp) {
            that.logo = resp.data.wap_index_logo
            document.title = resp.data.system_title
            setStorage('systemParams', resp.data)
          })
        }
      },
      filters: {
        //获取倒计时天
         timeFilterday: function (value) {
          value = Math.floor(value / 1000);
          var day = Math.floor(value / 86400);
          return day + '天'
        },       
        //获取倒计时时
         timeFilterhour: function (value) {
          value = Math.floor(value / 1000);
          value %= 86400;
          var hour = Math.floor(value / 3600);
          hour = hour < 10 ? '0' + hour : hour;
          return hour
        },          
        //获取倒计时分
         timeFilterminute: function (value) {
          value = Math.floor(value / 1000);
          value %= 86400;
          value %= 3600;
          var minute = Math.floor(value / 60);
          minute = minute < 10 ? '0' + minute : minute;
          return minute
        },          
        //获取倒计时秒
         timeFiltersecond: function (value) {
          value = Math.floor(value / 1000);
          value %= 86400;
          value %= 3600;
          var second = value %= 60;
          second = second < 10 ? '0' + second : second;
          return second
        }
      },
      mounted: function () {
        var that = this;
        this.getParams()
        // 首页轮播图
        httpRequest('POST', 'api_articles/banners/lists', { type_id: 11 }, {}, false).then(function (resp) {
          that.banners = resp.data;
          setTimeout(function () {
            carouselInit('#owl-carousel1', 1)
          }, 50);
        })

        // 加载用户自定义商品标签
        httpRequest('POST', 'api_goods/goods_tags/index', {}, {}, false).then(function (resp) {
          that.tags = resp.data;
        })

        // 加载公告
        httpRequest('POST', 'api_articles/annoncements/lists', {
          type_id: 29
        }, {}, false).then(function (resp) {
          that.annoncements = resp.data;
        })

        //加载优惠券
        httpRequest('POST', 'api_query/market/coupon', {}, {}, false).then(function (resp) {
          that.coupons = resp.data.filter(function(item){
            return item.coupon_type == 'full'
          });
          setTimeout(function () {
              changecoupons();
          }, 50);

        })
        //加载积分商品
         httpRequest('POST', 'api_score_shop/score_goods/lists', {}, {}, false).then(function (resp) {
          resp.data.push({});
          that.scoregoods =resp.data;
            // 限时折扣轮播初始
            setTimeout(function () {
              // carouselInit('#xianshizhekou', 3)
              $('#jifenduihuan').owlCarousel({
                loop: false,
                nav: false,
                autoplay: false,
                autoplayTimeout: 4000,
                items:4
              });

            }, 50);
        })    
    
         // 查询当前拼团模式、加载拼团商品       
        httpRequest('POST', 'api_group_buy/rules/index').then(function (resp) {
          that.group_shop_type = resp.data.type;
          if (that.group_shop_type == 1) {
               httpRequest('POST', 'api_group_buy/group_buy_system_goods/lists', {}, {}, false).then(function (resp) { 
                   that.groupgoods =resp.data;
               })
          }
          else if (that.group_shop_type == 2) {
               httpRequest('POST', 'api_group_buy/group_buy_user_goods/lists', {}, {}, false).then(function (resp) { 
                   that.groupgoods =resp.data;
               })
          }
        });
        //加载精选产品
         httpRequest('POST', 'api_goods/goods/lists', {custom_tag:'精品'}, {}, false).then(function (resp) {
          that.choicegoods =resp.data;


          //console.log(resp.data)
        }) 
        //加载新品产品   
           httpRequest('POST', 'api_goods/goods/lists', {custom_tag:'新品'}, {}, false).then(function (resp) {
            resp.data.push({});
           that.newgoods =resp.data;
            setTimeout(function () {
              $('#xinpinhuodong').owlCarousel({
                pagination:false,
                loop: false,
                nav: false,
                autoplay: false,
                autoplayTimeout: 4000,
                items: 4
              });

            }, 50);

         })         
     
        // 加载限时折扣
        httpRequest('POST', 'api_query/market/activity', {}, {}, false).then(function (resp) {
          if (resp.data.discount) {
            // 计算截至时间
            resp.data.discount[0].deadline = resp.data.discount[0].end_timestamp * 1000 - Date.now();
            // 限时折扣跳转
            resp.data.discount[0].rule_info.forEach(function (item) {
              item.href = location.origin + '/wap/index/goods_detail?isDiscountGoods=1&goodsId=' + item.goods_id
            })
            that.discountActivity = resp.data.discount[0];
            // 限时折扣轮播初始
            setTimeout(function () {
              // carouselInit('#xianshizhekou', 3)
              $('#xianshizhekou').owlCarousel({
                loop: false,
                nav: false,
                autoplay: true,
                autoplayTimeout: 4000,
                items: 4
              });

            }, 50);
            // 倒计时
            setInterval(function () {
              that.discountActivity.deadline -= 1000;
            }, 1000)
          }
        }).catch(function (e) {
          console.log(e)
        });
        // 加载商品
        var prePageData = getStorage('preIndexlistPageData', sessionStorage);
        if (prePageData) {
          that.goodslist = prePageData.data;
          page = prePageData.page;
          document.documentElement.scrollTop = prePageData.scrollTop;
          if (prePageData.data.length % 10 == 0) {
            document.body.onscroll = scrollEvent;
          }
        } else {
          that.loadGoods();
        }
      }
    });

  </script>
</body>

</html>