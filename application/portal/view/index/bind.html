<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=no, width=device-width">
  <meta name="keywords" content="wancllshop">
  <title></title>
  <!-- 公共资源文件引入 -->
  <link rel="stylesheet" href="/public/static/common/css/loading.css" type="text/css">

  <link rel="stylesheet" href="/public/static/wap/aui/css/aui.css" type="text/css">
  <link rel="stylesheet" href="/public/static/wap/css/wap.css" type="text/css">
  <link rel="stylesheet" type="text/css" href="/public/static/wap/aui/css/aui-flex.css" />

  <!-- 图标库 -->
  <link rel="stylesheet" type="text/css" href="/public/static/common/css/ali_icon/iconfont.css" />

  <script src="/public/static/jquery-3.2.1.min.js" type="text/javascript"></script>
  <script src="/public/static/layer-v3.1.1/layer/layer.js" type="text/javascript"></script>
  <script src="/public/static/vue/vue-2.5.15/vue.min.js" type="text/javascript"></script>


  <script src="/public/static/common/script/common.js" type="text/javascript"></script>
  <script src="/public/static/common/script/config.js" type="text/javascript"></script>
  <script src="/public/static/common/script/wapRouter.js" type="text/javascript"></script>

  <script src="/public/static/axios/axios.min.js"></script>
  <script src="/public/static/common/script/httpPromise.js"></script>
  <link rel="icon" id="icon-img" href="" type="image/x-icon"/>


  <!-- <script>
    document.title = getStorage('systemParams').system_title || ''
    document.getElementById("icon-img").href = getStorage('systemParams').web_icon;
  </script> -->
<link rel="stylesheet" href="/public/static/OwlCarousel2-2.2.1/assets/owl.carousel.min.css">
<link rel="stylesheet" href="/public/static/OwlCarousel2-2.2.1/assets/owl.theme.default.min.css">
<script src="/public/static/OwlCarousel2-2.2.1/owl.carousel.min.js"></script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>

<body>
    {include file="/index/header" /}
    <div id="app">
        <div class="w1200 margin-tt-15 over  black-text">
            <div class="left">
                <!-- 个人信息卡 -->
                <div class="card-title-wrap">
                    <img src="/public/static/portal/img/title-back.png" class="responsive-img">
                    <div class="margin-10 over card-text-wrap">
                        <div class="ridius-img left margin-15">
                            <img :src="user.avatar" alt="">
                        </div>
                        <div class="left margin-top-15">
                            <div class="font-size-18 margin-top-15 white-text"  v-text="user.nick_name || user.mobile"></div>
                            <div class="blue lighten-1 margin-top-5" style="border-radius: 4px;padding: 2px 4px;">
                                <img src="/public/static/portal/img/lr.png" alt="">
                                <span class="font-size-12 white-text" v-text="level"></span>
                            </div>
                        </div>
                    </div>
                    <div class="rate-line font-size-12 blue-text text-lighten-5">
                        <div class="rataing-nember  margin-15" v-text=" '成长值  ' + score"></div>
                        <div class="ratas-nember right"></div>
                    </div>
                </div>
                <div class="white grey-text text-darken-3 margin-top-15" style="border-radius: 5px">
                    <div class="card-right-nav-box  margin-10 padding-tt-10" style="border: none">
                        <div class="card-right-nav">
                            <div class="font-size-18 over margin-tt-10">
                                <i class="iconfont icon-icon_order left text-lighten-1" style="font-size:24px; margin-right: 5px;height: 30px;line-height: 30px;"></i>
                                <span class="left margin-top-5">交易管理</span>
                            </div>
                            <ul class="card-right-nav-ul">
                                <li class="margin-tt-13" @click="goto('cart_list')">购物车</li>
                                <li class="margin-tt-13" @click="goto('order_list')">我的订单</li>
                                <li class="margin-tt-13" @click="goto('comment_list')">我的评价</li>
                            </ul>
                        </div>
                    </div>
                    <div class="card-right-nav-box  margin-10 padding-tt-10">
                        <div class="card-right-nav">
                            <div class="font-size-18 over margin-tt-10">
                                <i class="iconfont icon-icon_order left text-lighten-1" style="font-size:24px; margin-right: 5px;height: 30px;line-height: 30px;"></i>
                                <span class="left margin-top-5">账号管理</span>
                            </div>
                            <ul class="card-right-nav-ul">
                                <li class="margin-tt-13" @click="goto('setting')">个人信息</li>
                                <li class="margin-tt-13" @click="goto('account')">账号安全</li>
                                <li class="margin-tt-13" @click="goto('idcard_auth')">实名认证</li>
                                <li class="margin-tt-13" @click="goto('address_list')">地址管理</li>
                                <li class="margin-tt-13" @click="goto('collection_list')">我的收藏</li>
                                <li class="margin-tt-13" @click="goto('level')">成长值
                                    <span class="blue-text text-lighten-1" v-text="'('+score+')'"></span>
                                </li>
                                <li class="margin-tt-13" @click="goto('bind')">第三方账户</li>
                            </ul>
                        </div>
                    </div>
                    <div class="card-right-nav-box margin-10 padding-tt-10">
                        <div class="card-right-nav">
                            <div class="font-size-18 over margin-tt-10">
                                <i class="iconfont icon-icon_order left text-lighten-1" style="font-size:24px; margin-right: 5px;height: 30px;line-height: 30px;"></i>
                                <span class="left margin-top-5">资产管理</span>
                            </div>
                            <ul class="card-right-nav-ul">
                                <li class="margin-tt-13" @click="goto('wallet')">我的钱包</li>
                                <li class="margin-tt-13" @click="goto('bankcard_list')">我的银行卡</li>
                                <li class="margin-tt-13" @click="goto('my_coupon_list')">我的优惠券
                                    <span class="blue-text text-lighten-2"></span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="right right-content">
                <div class="padding-15 white">
                    <div class="margin-15 font-size-18 black-text padding-tt-5">第三方信息绑定</div>
                    <div class="margin-15 grey-text text-darken-3 flex padding-15 card-qqwx-list">
                        <div class="flex1 margin-top-10">
                            <img src="/public/static/portal/img/bind-wx.png" alt="" class="margin-right-15">
                            <sapn>绑定微信账号</span>
                        </div>
                        <div class="margin-top-15 card-active bt" v-if="wechat == ''" @click="bind('third_wechat')">未绑定</div>
                        <div class="margin-top-15" v-else-if="wechat != ''" @click="noBind('wechat')">解除绑定</div>
                    </div>
                    <div class="margin-15 grey-text text-darken-3 flex padding-15  card-qqwx-list">
                        <div class="flex1 margin-top-10">
                            <img src="/public/static/portal/img/bind-qq.png" alt="" class="margin-right-15">
                            <span>绑定QQ账号</span>
                        </div>
                        <div class="margin-top-15 card-active bt" v-if="qq == ''" @click="bind('third_qq')">未绑定</div>
                        <div class="margin-top-15" v-else-if="qq != ''" @click="noBind('qq')">解除绑定</div>
                    </div>
                </div>
                <div class="margin-top-15">
                    <img src="/public/static/portal/img/lien-img.png" alt="" class="responsive-img">
                </div>
            </div>
        </div>
        <div class="w1200 white over margin-btn-15">
            <div class="foot-list-title black-text text-lighten-1 margin-15 font-size-18 padding-left-15">猜你喜欢</div>
            <div class="foot-list margin-15 over">
                <div class="left foot-list-box" v-for="guessGood in guessGoods" @click="goto('goods_detail',{goodsId:guessGood.id})">
                    <img :src="guessGood.thum" class="responsive-img">
                    <div class="padding-10">
                        <div class="font-size-16 black-text" v-text="guessGood.name"></div>
                        <div class="margin-top-10 over">
                            <div class="left">
                                <span class="red-text font-size-16" v-text="'￥' + guessGood.sell_price"></span>
                                <span class="font-size-10 grey-text lighten-1" v-text="'￥' + guessGood.sell_price"></span>
                            </div>
                            <div class="right font-size-12 grey-text lighten-1" v-text="'月销量：'+guessGood.sell_num"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {include file="index/footer" /}
    <script>
        var app = new Vue({
            el: '#app',
            data: {
                currentPage: parseInt(querystring.currentPage) || 1, //当前页
                currentPageSize: 2, //当前页容量
                activeFooterIndex: 4,
                title: '个人中心',
                user: user,
                haveNoData: false,
                level: '',
                score: '',
                qq: '',
                wechat: '',
                third_wechat: '',
                third_qq: '',
                code: querystring.code || '',
                guessGoods: '',
            },
            methods: {
                authentication: function () {
                    httpRequest('POST', 'api_query/users/auth',{},function (resp) {
                        var status = resp.data.status;
                        if (status == 0 || status == 2) {
                            goto('idcard_auth', { status: status, id: resp.data.id });
                        } else if (status == 1 || status == 3) {
                            goto('idcard_info');
                        }
                    })
                },
                bind: function (type) {
                    if (type == 'third_wechat') {
                        //非微信浏览器
                        setStorage('thirdType', 'third_wechat');
                        httpRequest('POST', 'api_systems/Oauth/wechat_qrcode',{},function (resp) {
                            location = resp.data;
                        })
                    } else if (type == "third_qq") {
                        setStorage('thirdType', 'third_qq');
                        httpRequest('POST', 'api_systems/Oauth/qq_pc',{},function (resp) {
                            location = resp.data;
                        })
                    }
                },
                noBind: function (type) {
                    layer.confirm('确定解绑?', { title: '提示' }, function (index) {
                        layer.close(index);
                        httpRequest('POST', 'api_users/binding/delete', {
                            openid_type: type
                        },function (resp) {
                            layer.msg(resp.msg);
                            setTimeout(function () {
                                location.reload();
                            }, 50)
                        })
                    })
                }
            },
            mounted: function () {
                //查询所有绑定状态
                httpRequest('POST', 'api_query/users/asset',{},function (resp) {
                    app.level = resp.data.level;
                    app.score = resp.data.score;
                })
                //查询会员第三方绑定信息
                httpRequest('POST', "api_query/oauth/binding",{},function (resp) {
                    console.log(resp.data.wechat_openid);
                    if (resp.data.wechat_openid != '') {
                        app.wechat = resp.data.wechat;
                    }
                    if (resp.data.qq_openid != '') {
                        app.qq = resp.data.qq;
                    }
                    if (app.code.length > 0) {
                        saveBind(app.code, querystring.state);
                    }
                })

                httpRequest('POST', 'api_goods/goods/lists', { is_top: 1 },function (resp) {
                    app.guessGoods = resp.data;
                }, { 'page-num': 1, 'page-limit': 4 })
            }
        })
        //绑定第三方账号
        saveBind = function (code, type) {
            if (type == "qq_pc") {
                var url = 'api_systems/Oauth/qq_get_openid_pc';
            } else {
                var url = 'api_systems/Oauth/wechat_get_openid';
            }
            httpRequest('POST', url, { code: app.code },function (resp) {
                    if (resp.data.length > 0) {
                        return httpRequest('POST', 'api_users/binding/save_in_login', { openid_type: type, openid: resp.data.openid },function (resp) {
                            layer.msg(resp.msg);
                        })
                    }
                })
        }
    </script>
</body>

</html>