<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=no, width=device-width">
  <meta name="keywords" content="wancllshop">
  <title></title>
  <!-- 公共资源文件引入 -->
  <link rel="stylesheet" href="/public/static/common/css/loading.css" type="text/css">

  <link rel="stylesheet" href="/public/static/wap/aui/css/aui.css" type="text/css">
  <link rel="stylesheet" href="/public/static/wap/css/wap.css" type="text/css">
  <link rel="stylesheet" type="text/css" href="/public/static/wap/aui/css/aui-flex.css" />

  <!-- 图标库 -->
  <link rel="stylesheet" type="text/css" href="/public/static/common/css/ali_icon/iconfont.css" />

  <script src="/public/static/jquery-3.2.1.min.js" type="text/javascript"></script>
  <script src="/public/static/layer-v3.1.1/layer/layer.js" type="text/javascript"></script>
  <script src="/public/static/vue/vue-2.5.15/vue.min.js" type="text/javascript"></script>


  <script src="/public/static/common/script/common.js" type="text/javascript"></script>
  <script src="/public/static/common/script/config.js" type="text/javascript"></script>
  <script src="/public/static/common/script/wapRouter.js" type="text/javascript"></script>

  <script src="/public/static/axios/axios.min.js"></script>
  <script src="/public/static/common/script/httpPromise.js"></script>
  <link rel="icon" id="icon-img" href="" type="image/x-icon"/>


  <!-- <script>
    document.title = getStorage('systemParams').system_title || ''
    document.getElementById("icon-img").href = getStorage('systemParams').web_icon;
  </script> -->
<link rel="stylesheet" href="/public/static/OwlCarousel2-2.2.1/assets/owl.carousel.min.css">
<link rel="stylesheet" href="/public/static/OwlCarousel2-2.2.1/assets/owl.theme.default.min.css">
<script src="/public/static/OwlCarousel2-2.2.1/owl.carousel.min.js"></script>
<link href="/public/static/portal/css/index.css" type="text/css" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	
	<style type="text/css">
		body{background-color:#f4f4f4;}
		.assess-content{margin:0 auto;background-color:#ffffff;margin-top:56px;margin-bottom:100px;width:998px;}
		.assess-content .line-top{margin-top:30px;}
		.assess-cont{padding:35px 30px;position:relative;}
		.assess-cont .title{color:#000000;margin-top:0px;margin-bottom:20px;}
		.assess-cont .assess-text{height:auto;line-height:1.68;color:#000000;}
		.assess-cont .text-input-cont{width:770px;}
		.assess-cont .point-out{position:absolute;width:136px;left:15px;bottom:0px;text-align:center;line-height:2.7;color: rgb(160, 160, 160);}

		.assess-content .assess-score{padding:0 30px;margin-bottom:10px;}
		.assess-content .assess-score .title{color:#000000;width:80px;line-height:36px;}
		.assess-content .assess-score .star{}
		.assess-content .assess-score .star i.on{color:#108ee9;background-color:rgba(255,255,255,0);}
		.assess-content .assess-score .star i{color:#999999;font-size:24px;margin:0 1px;}

		.upimg-div .z_file{width:138px;margin-top:0px;margin-left:0px;}
		.upimg-div .up-section{width:138px;margin-right:37px;margin-left:0px;border:1px solid #d7d7d7;height:118px;padding:15px;}
		.upimg-div .up-section img{max-height:100%;width:auto;max-width:100%;}
		.upimg-div .img-mun{position:absolute;right:30px;bottom:30px;font-size:14px;color:#a0a0a0;}
		.z_photo section{float:left;margin-top:0px;}
		.assess-content .tishi{color:#a0a0a0;padding:0 30px;margin-bottom:60px;}
		.assess-content .tishi span{color:#ff0000;}
		.assess-button{color:#ffffff;width:144px;height:40px;background-color:#108ee9;color:#ffffff;margin-left:30px;margin-bottom:15px;border-radius:40px;font-size:14px;}
		.imgs{ width:100%;}
		.imgs img{max-width:20%;display:inline-block;background-color:#a0a0a0;border:none;}
		.imgs .photo{background:none;}
	</style>
</head>
<body>
	{include file="/index/header" /}
	<div class="w1200" id="app">
				<div class="assess-content border-grey padding-15">
					<div class="border-btn line-top"></div>
					<div class="assess-cont">
						<h4 class="title font-size-16">商品评价 :</h4>
						<div class="text-input-cont">
							<textarea width="100%" class="assess-text border-grey padding-15 font-size-14" rows="8" placeholder="请输入评论" v-model="message"></textarea>
						</div>
						<p class="point-out font-size-14">5-1000个汉字</p>
					</div>
					<div class="assess-score clearfix">
						<div class="left title font-size-16">商品评分 :</div>
						<div class="left star">
							<i class="iconfont icon-shoucang" v-for="(item,key) in [1,2,3,4,5]" :key="key" @click="star(key + 1)" :style="{color: ((key + 1) <= starLevel ? '#108ee9' : '#ccc')}"></i>
						</div>
					</div>
					<div class="z_photo upimg-div clearfix" style="background:#fff;position:relative;padding-bottom:18px;">
							<div class="imgs">
								<img :src="img" class="photo" v-for="(img,key) in imgs" :key="key">
								<img style="height:120px;width:120px" src="/public/static/portal/images/add_img.png" @click="fileClick()">
								<input @change="fileChange($event)" id="upload_file" class="file" style="display:none" type="file" multiple>
							</div>
						 
						<p class="img-mun">(5/5)</p>
					</div>
					<p class="tishi font-size-14"><span>*</span> 每张不超过5M，支持jpg，bmp，png格式</p>
					<button @click="submit()" class="assess-button">提交保存</button>
				</div>
	</div>
	{include file="index/footer" /}
</body>
<script>
    var app = new Vue({
      el: '#app',
      data: {
        title: '发表评论',
        goods: getStorage('goods', sessionStorage),
        message: '',
        imgs: [],
        starLevel: 0,
      },
      methods: {
        star: function (level) {
          this.starLevel = level;
        },
        submit: function () {
          if (!this.starLevel){
            layer.msg('请选择星级');
            return;
          }
          if (!this.message) {
            layer.msg('请输入评论内容');
            return;
          }
          httpRequest('POST', 'api_goods/goods_comments/save',{
            order_id: querystring.orderId,
            goods_id: this.goods.goods_id,
            score: this.starLevel,
            content: this.message,
            imgs: this.imgs,
            status: 1,
          },function (resp) {
            layer.msg(resp.msg);
            setTimeout(function () {
              goto('order_list');
            }, 500);
          })
        },
        fileClick: function () {
          document.getElementById('upload_file').click()
        },
        //文件发生该变
        fileChange: function (el) {
          if (!el.target.files[0].size) return;
          this.fileList(el.target);
          el.target.value = ''
        },
        //文件列表
        fileList: function (fileList) {
          var files = fileList.files;
          for (var i = 0; i < files.length; i++) {
            //判断是否为文件夹
            if (files[i].type != '') {
              this.fileAdd(files[i]);
            } else {
              //文件夹处理
              this.folders(fileList.items[i]);
            }
          }
        },
        //文件夹处理
        folders: function (files) {
          var _this = this;
          //判断是否为原生file
          if (files.kind) {
            files = files.webkitGetAsEntry();
          }
          files.createReader().readEntries(function (file) {
            for (var i = 0; i < file.length; i++) {
              if (file[i].isFile) {
                _this.foldersAdd(file[i]);
              } else {
                _this.folders(file[i]);
              }
            }
          })
        },
        foldersAdd: function (entry) {
          var _this = this;
          entry.file(function (file) {
            _this.fileAdd(file)
          })
        },
        fileAdd: function (file) {
          //判断是否为图片文件
          if (file.type.indexOf('image') == -1) {
            layer.msg('请选择图片类型的文件')
          } else {
            var that = this;
            var reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function () {
              if (that.imgs.length < 5) {
                file.src = this.result;
                that.imgs.push(file.src)
              } else {
                layer.msg('最多上传5张图片')
              }
            }
          }
        },
      },
      computed: {

      },
      mounted: function () {
        // console.log(app.goods);
        
      }
    })
  </script>
</html>