<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="icon" id="icon-img" href="" type="image/x-icon"/>
  <title></title>
  <script>

    (function () {
      if (/ie/i.test(navigator.userAgent)) {
        location = location.protocol + '//' + location.hostname + ':' + location.port + '/index.php/admin/accounts/ie/'
      }
    })()

  </script>
  <!-- admincss样式 -->
  <link rel="stylesheet" href="/public/static/admin/css/admin.css" type="text/css">
  <!-- 阿里图标库 -->
  <link rel="stylesheet" href="//at.alicdn.com/t/font_589115_ih58fc1w5fm9529.css" type="text/css">
  <!-- loading样式 -->
  <link rel="stylesheet" href="/public/static/common/css/loading.css" type="text/css">
  <!-- jq -->
  <script src="/public/static/jquery-3.2.1.min.js"></script>
  <!-- vue -->
  <script src="/public/static/vue/vue-2.5.15/vue.min.js" type="text/javascript"></script>
  <!-- layer -->
  <script src="/public/static/layer-v3.1.1/layer/layer.js" type="text/javascript"></script>
  <!-- layui -->
  <link rel="stylesheet" href="/public/static/layui/css/layui.css" type="text/css">
  <script src="/public/static/layui/layui.js" type="text/javascript"></script>
  <!-- 公共js -->
  <script src="/public/static/common/script/common.js"></script>
  <script src="/public/static/common/script/config.js"></script>
  <!-- ajax 请求 -->
  <script src="/public/static/axios/axios.min.js"></script>
  <script src="/public/static/common/script/httpPromise.js"></script>
  <!-- element -->
  <script type="text/javascript">
    // 登录页重新获取配置信息
    var basic_info = '';
    httpRequest('post', 'api_systems/params/getParams', {
      type: 'basic'
    }, {}, false).then(resp => {
      setStorage('basic_info', resp.data);
      basic_info = resp.data;

      document.title = basic_info.system_title;
      document.getElementById("icon-img").href = basic_info.web_icon;
      document.getElementById("admin-login-logo").src = basic_info.admin_login_logo;
      document.getElementById("system_name").innerText = basic_info.system_title;
    });
  </script>
</head>
<style type="text/css">
  html {
    width: 100%;
    height: 100%;
    overflow: hidden;
  }

  body {
    background: url(/public/static/images/bkimg.jpg) center center / cover no-repeat scroll rgba(0, 0, 0, 0);
    /*background-size:100% 100%;background-repeat:no-repeat;*/
    width: 100%;
    height: 100%;
    /*background-position-y:bottom;*/
  }

  .login-cont {
    width: 470px;
    box-sizing: border-box;
    background-color: rgba(255, 255, 255, 0.77);
    background-image: url(/public/static/images/login-bk.png);
    background-repeat: no-repeat;
    background-position-y: bottom;
    background-size: 100% auto;
    padding-top: 45px;
    padding-bottom: 50px;
    border-radius: 3px;
    padding-left: 34px;
    padding-right: 34px;
  }

  .login-title {
    display: block;
    max-width: 100%;
    display: inline-block;
    height: auto;
    margin: 0 auto;
    padding-bottom: 10px;
    vertical-align: middle;
    padding-bottom: 0px;
  }

  .login-cont {
    padding-top: 24px;
    position: relative;
  }

  .login-logo {
    width: 60px;
    height: 26px;
    line-height: 26px;
    background-color: rgb(252, 173, 4);
    border-radius: 4px;
    display: inline-block;
    vertical-align: middle;
    font-size: 12px;
    color: rgb(27, 43, 68);
    position: relative;
  }

  .login-logo:after {
    content: "";
    position: absolute;
    left: -11px;
    top: 7px;
    border: 5.5px solid rgb(252, 173, 4);
    border-top-color: transparent;
    border-bottom-color: transparent;
    border-left-color: transparent;
  }

  .layui-form-item .ftitle {
    font-size: 16px;
    color: rgb(40, 40, 40);
    line-height: 1.2;
  }

  .fo-password {
    padding-top: 20px;
    padding-bottom: 10px;
  }

  .layui-form-pane .layui-form-checkbox {
    margin-top: 0px !important;
    margin-bottom: 0px !important;
  }

  .login-submit {
    margin-bottom: 0px;
  }

  .login-error {
    position: absolute;
    right: 0px;
    bottom: -28px;
    color: rgb(176, 216, 252);
    font-size: 14px;
    line-height: 1.2;
  }

  .login-error:hover {
    color: #8dacc7;
  }

  .login-input-list .layui-input-block {
    margin-left: 0px;
    width: 100%;
    background-color: rgb(255, 255, 255);
    border: 1px solid rgb(233, 233, 233);
    border-radius: 5px;
    margin-bottom: 24px;
  }

  .login-input-list .layui-input {
    height: 60px;
    padding-left: 15px;
    color: #3f4555;
    font-size: 16px;
  }

  .login-input-list .layui-input::-webkit-input-placeholder {
    /* WebKit, Blink, Edge */
    color: rgb(153, 153, 153);
  }

  .login-input-list .layui-input:-moz-placeholder {
    /* Mozilla Firefox 4 to 18 */
    color: rgb(153, 153, 153);
  }

  .login-input-list .layui-input::-moz-placeholder {
    /* Mozilla Firefox 19+ */
    color: rgb(153, 153, 153);
  }

  .login-input-list .layui-input:-ms-input-placeholder {
    /* Internet Explorer 10-11 */
    color: rgb(153, 153, 153);
  }

  .fo-password .layui-form-checkbox {
    background-color: rgba(255, 255, 255, 0);
    width: 18px;
    height: 18px;
    border: 2px solid #7c7c7c;
    border-radius: 3px;
    box-sizing: border-box;
    padding-right: 0px;
    line-height: 1;
    margin-right: 12px;
    margin-left: 0px;
    margin-top: 16px;
    margin-bottom: 16px;
  }

  .fo-password .layui-icon {
    font-size: 12px;
    width: 18px;
    height: 12px;
    left: 50%;
    top: 50%;
    -moz-transform: translate(-50%, -50%);
    -ms-transform: translate(-50%, -50%);
    -webkit-transform: translate(-50%, -50%);
    transform: translate(-50%, -50%);
    opacity: 0;
  }

  .fo-password label {
    color: #777777;
  }

  .fo-password .layui-form-checked i {
    opacity: 1;
    color: #7c7c7c;
  }

  .login-submit .layui-btn {
    display: block;
    width: 100%;
    height: 60px;
    line-height: 60px;
    color: #ffffff;
    border-radius: 3px;
    font-size: 17px;
    background-color: #3f4555;
  }

  .fo-ma-div {
    text-align: right;
  }

  .fo-ma-div .fo-ma-div-a {
    color: rgb(89, 94, 106);
    font-size: 14px;
    color: rgb(89, 94, 106);
  }
</style>

<body style="background-color: #23262E;position:relative;">

  <div class="login-cont layui-form layui-form-pane" style="width: 500px;position:absolute;left:50%;top:50%;transform:translate(-50% , -50%);-moz-transform: translate(-50%, -50%);-ms-transform: translate(-50%, -50%);-webkit-transform: translate(-50%, -50%);transform: translate(-50%, -50%);">
    <!-- margin: 0 auto;margin-top: 150px; -->
    <div class="layui-form-item" style="text-align: center;">
      <h2 style="font-size: 50px;color: #FFF;margin-bottom:25px;">
        <img class="login-title" id="admin-login-logo" src="">
        <div class="login-logo">
          <?php echo (WANCLL_ENV == 'prod') ? 'Pro' : 'beta'; ?>
        </div>
      </h2>
      <p class="ftitle" id="system_name"></p>
    </div>
    <br />
    <div class="layui-form-item login-input-list">
      <div class="layui-input-block">
        <input type="text" name="guid" id="guid" lay-verify="required" placeholder="请输入用户账号" autocomplete="off" class="layui-input">
      </div>
    </div>

    <div class="layui-form-item login-input-list" style="margin-bottom:0px;">
      <div class="layui-input-block" style="margin-bottom:0px;">
        <input type="password" name="password" id="password" lay-verify="required" placeholder="请输入账号密码" autocomplete="off" class="layui-input">
      </div>
    </div>
    <div class="fo-password">
      <input type="checkbox" class="fo-password-input" id="rember-password">
      <label for="fo-password">记住密码</label>
    </div>
    <div class="layui-form-item login-submit" style="text-align: center;">
      <button class="layui-btn" id="enter-login" lay-submit lay-filter="*">登&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;录</button>
    </div>
    <p class="login-error" style="cursor: pointer;" onclick="goNew()">体验新版登录？</p>
  </div>
  <script>
    if (user) {
      rmStorage('selectLeftNavId');
      rmStorage('selectTopNavId');
      location = location.origin + '/admin/data/index'
    }
    function goNew() {
      location = location.origin + '/admin/accounts/login_new'
    }
    function combinNavIconClass(navs) {
      navs.map((i) => {
        if (i.icon) {
          let iconClass = {};
          iconClass[i.icon] = true;
          i.icon = iconClass;
        }
        if (i._child) {
          combinNavIconClass(i._child);
        }
      })
    }
    var guid = getStorage('guid');
    var password = getStorage('password');
    if (guid != null && password != null) {
      $("#guid").val(guid);
      $("#password").val(password);
      $("#rember-password").attr('checked', true);
    }

    var form;
    layui.use(['form'], function () {
      form = layui.form;

      //提交表单
      form.on('submit(*)', function (data) {
        var params = data.field;

        httpRequest('POST', 'api_admins/admin_accounts/login', params).then(resp => {
          rmStorage('selectLeftNavId');
          rmStorage('selectTopNavId');
          // resp.data.navs = JSON.parse(JSON.stringify(resp.data.navs).replace(/http:\/\/v4\.wx\.wygoo\.com/g, location.origin))
          // resp.data.navs = JSON.parse(JSON.stringify(resp.data.navs).replace(/http:\/\/192\.168\.31\.183/g, location.origin))
          resp.data.user.avatar = resp.data.user.avatar || '/public/static/images/avatar.png';
          // 组合菜单类名
          combinNavIconClass(resp.data.navs)
          setStorage('adminNavs', resp.data.navs);
          setStorage(getClientType() + 'User', resp.data.user);
          setStorage(getClientType() + 'Token', resp.data.token);

          layer.msg(resp.msg);

          // 判断是否记住密码
          if ($("#rember-password").is(':checked')) {
            setStorage('guid', params.guid)
            setStorage('password', params.password)
          } else {
            rmStorage('guid')
            rmStorage('password')
          }

          setTimeout(_ => {
            location = location.origin + '/admin/data/index'
          }, 1000);
        }).catch(_ => {

        })
      });
    });

    // 回车提交表单
    document.onkeydown = function (e) { 
        // 兼容FF和IE和Opera
        var theEvent = window.event || e;
        var code = theEvent.keyCode || theEvent.which || theEvent.charCode;
        if (code == 13) {
            document.getElementById("enter-login").click();
        }
    }
  </script>
</body>

</html>